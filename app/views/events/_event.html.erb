<h1><%= @event.name %></h1>

<% if @event.prerelease? && !current_user.early_access %> <!-- Non-Early Access Users branch -->
  <% if @event.ticket_sale_start_date.nil? %>
    Tickets for our next event will be available to buy here soon, watch this space!.
  <% else %>
    Tickets for our next event will be available to buy here on <%= @event.ticket_sale_start_date.strftime("%d/%m/%Y at %I:%M:%S %p") %> (GMT).
  <% end %>
<% elsif @event.live? || current_user.early_access %>
  <% if @event.tickets_sold_for_code(current_user.membership_number) > 0 %>  <!-- Brought tickets branch -->
    <p>
      You have bought the
      <%= pluralize(@event.tickets_sold_for_code(current_user.membership_number), 'ticket') %>
      available to you. Look below to see how you can participate.
    </p>
  <% elsif current_user.ticket_type != :general %> <!-- Non-General ticket branch -->
    <%= render partial: '/events/buy_ticket' %>
  <% else %> <!-- General ticket branch -->
    <p class="mb-1">
      <% if @event.tickets_sold_for_code(current_user.membership_number) > 0 %>
        You have already bought
        <%= pluralize(@event.tickets_sold_for_code(current_user.membership_number), 'ticket') %>.
        You can buy
        <%= pluralize(@event.available_tickets_for_code(current_user.membership_number), 'more ticket') %>.
      <% elsif @event.available_tickets_for_code(current_user.membership_number) > 0 %>
        You can buy
        <%= pluralize(@event.available_tickets_for_code(current_user.membership_number), 'ticket') %>.
      <% else %>
        Currently, there are no tickets available to purchase!
      <% end %>
    </p>
    <%= render partial: '/events/buy_ticket' %>
  <% end %>
<% end %>

<%= render partial: '/tickets/low_income' %>

<% if @event.tickets_sold_for_code(current_user.membership_number) > 0 %>
  <hr />
  <%= render partial: '/volunteers/applied_list' %>
  <%= render partial: '/volunteers/list' %>
<% end %>

<% if @event.tickets_sold_for_code(current_user.membership_number) == 0 %>
  <p>
    <strong>
      Bought a transferred ticket and can't see the volunteer opportunities on this page? Drop an email to <a href="mailto:members@londondecom.org">members@londondecom.org</a> and we'll sort you out!
    </strong>
  </p>
  <hr />
<% end %>

<%= render partial: '/events/info' %>
